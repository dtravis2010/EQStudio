/* Theme pass */
:root{
  /* Semantic tokens phase 1 */
  --space-1:4px; --space-2:8px; --space-3:12px; --space-4:16px; --space-5:20px; --space-6:24px;
  --font-xs:11px; --font-sm:12px; --font-md:13px; --font-lg:15px; --font-xl:18px;
  --radius-sm:4px; --radius-md:8px; --radius-lg:12px;
  --elev-1:0 1px 2px rgba(0,0,0,.35),0 0 0 1px rgba(255,255,255,.03);
  --elev-2:0 4px 8px -2px rgba(0,0,0,.45),0 0 0 1px rgba(255,255,255,.04);
  --elev-focus:0 0 0 2px var(--epic-accent), 0 0 0 4px rgba(93,145,255,.35);
  --tx-blue:#0f3b5f;
  --tx-green:#1e8a78;
  --accent:#2563eb;
  --accent-glow:rgba(37,99,235,.35);
  --bg:#0e1823;
  --bg-alt:#152332;
  --panel:rgba(22,34,47,0.78);
  --panel-border:#1f3245;
  --panel-overlay:rgba(255,255,255,0.04);
  --text:#e6edf3;
  --text-dim:#8aa2b5;
  --line:#25394c;
  --focus:#3b82f6;
  --danger:#dc2626;
  --warn:#f59e0b;
  --ok:#16a34a;
  --radius:12px;
  --blur:22px;
  --shadow:0 4px 12px -2px rgba(0,0,0,.4), 0 0 0 1px rgba(255,255,255,.03);
  --transition:160ms cubic-bezier(.4,.2,.2,1);
  --epic-bg:#1b2230;
  --epic-panel:#202b3a;
  --epic-accent:#5d91ff;
  --epic-accent-glow:rgba(93,145,255,.6);
  --epic-border:#2e3a4a;
  --epic-text:#d8e2ef;
  --epic-warn:#ffb347;
  --epic-danger:#ff647c;
  --epic-green:#4cc38a;
}
/* SplitPane */
.split-pane{position:relative;display:flex;flex:1;min-height:0;min-width:0}
.split-pane.sp-vert{flex-direction:row}
.split-pane.sp-horiz{flex-direction:column}
.split-pane .sp-pane{position:relative;min-width:0;min-height:0;display:flex;flex-direction:column}
.split-pane .sp-pane-a[data-dir='vertical']{width: var(--sp-a-size)}
.split-pane .sp-divider{flex:0 0 6px;cursor:col-resize;background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,0));position:relative}
.split-pane.sp-horiz .sp-divider{cursor:row-resize;background:linear-gradient(90deg,rgba(255,255,255,.04),rgba(255,255,255,0))}
.split-pane .sp-divider:after{content:"";position:absolute;inset:0;display:block;opacity:.2}
.split-pane .sp-divider:hover{background:rgba(255,255,255,.06)}

/* General styles */
*{box-sizing:border-box}
html,body,#root{height:100%}
body{margin:0;background:radial-gradient(circle at 25% 15%,#173044 0%, #0d1620 60%) fixed; color:var(--text); font-family:Inter, Segoe UI, Tahoma, sans-serif; -webkit-font-smoothing:antialiased}
body.epic {
  background:linear-gradient(135deg,#16202e,#0e141c 55%,#16202e);
  color:var(--epic-text);
  font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
}
.app{display:flex;flex-direction:column;height:100%}
.brandbar{height:3px;background:linear-gradient(90deg,#2563eb,#1e8a78,#9333ea); box-shadow:0 0 12px -2px var(--accent-glow)}

.toolbar{display:flex;align-items:center;gap:8px;padding:8px 14px;background:rgba(15,27,39,0.8);-webkit-backdrop-filter:saturate(160%) blur(18px);backdrop-filter:saturate(160%) blur(18px);border-bottom:1px solid var(--panel-border);box-shadow:var(--shadow)}
.toolbar button,.toolbar label.filebtn{background:linear-gradient(145deg,#1f3345,#172635);color:var(--text);border-radius:8px;padding:6px 12px;border:1px solid #2a455b;font-size:13px;letter-spacing:.3px;position:relative;overflow:hidden;transition:var(--transition)}
.toolbar button:hover,.toolbar label.filebtn:hover{background:#254055;border-color:#3e637d}
.toolbar button:active{transform:translateY(1px)}
.toolbar .spacer{flex:1}

.body.layout-grid{flex:1;display:grid;grid-template-columns:260px 1fr 310px;gap:14px;padding:14px;overflow:hidden}
.body.layout-grid.plus-right{grid-template-columns:240px 1fr 300px 260px}
.body.layout-flex{flex:1;display:flex;overflow:hidden;padding:8px;gap:8px}
.side-stack{display:flex;flex-direction:column;gap:8px;min-width:280px;width:320px}
.side-stack .panel{flex:1;min-height:0}
.panel{position:relative;display:flex;flex-direction:column;min-height:0;background:var(--panel);border:1px solid var(--panel-border);border-radius:var(--radius);-webkit-backdrop-filter:blur(var(--blur)) saturate(170%);backdrop-filter:blur(var(--blur)) saturate(170%);box-shadow:var(--shadow);overflow:hidden}
.panel:before{content:"";position:absolute;inset:0;background:linear-gradient(140deg,rgba(255,255,255,.05),rgba(255,255,255,0) 60%);pointer-events:none}
.panel h3{margin:0;padding:10px 14px;font-size:13px;letter-spacing:.5px;text-transform:uppercase;font-weight:600;color:var(--text-dim);border-bottom:1px solid var(--panel-border);background:linear-gradient(145deg,rgba(255,255,255,.04),rgba(255,255,255,0))}
.panel .content{padding:10px 12px;overflow:auto;/* scrollbar-width fallback */}
.panel .content::-webkit-scrollbar{width:10px}
.panel .content::-webkit-scrollbar-track{background:transparent}
.panel .content::-webkit-scrollbar-thumb{background:#244157;border-radius:12px;border:2px solid rgba(0,0,0,0)}
.panel .content::-webkit-scrollbar-thumb:hover{background:#2d5674}

/* LeftNav */
.leftnav .section{border:0;margin-bottom:6px} 
.leftnav .title{background:linear-gradient(120deg,#1b3042,#162635);color:var(--text-dim);border-left:3px solid #2563eb;border-radius:8px;margin:10px 6px 8px;padding:6px 10px;font-size:12px;display:flex;align-items:center;gap:6px}
.leftnav .title button{margin-left:auto;border:1px solid #2a455b;background:#203646;color:var(--text);border-radius:6px;padding:4px 8px;cursor:pointer;font-size:11px;transition:var(--transition)}
.leftnav .title button:hover{background:#2b4a5f}
.leftnav .item{margin:0 6px;padding:6px 8px;border-radius:8px;font-size:13px;display:flex;align-items:center;gap:6px;color:var(--text-dim);transition:var(--transition);cursor:pointer}
.leftnav .item:hover{background:#1f3242;color:var(--text)}
.leftnav .item.active{background:#214058;color:#fff}
.leftnav .question-row button.mini{margin-left:auto;border:1px solid #2a455b;background:#203646;color:var(--text-dim);border-radius:5px;padding:2px 8px;font-size:11px;cursor:pointer;transition:var(--transition)}
.leftnav .question-row button.mini:hover{background:#2d475a;color:var(--text)}
.leftnav .bank{background:#162635;display:flex;justify-content:space-between;align-items:center;padding:6px 8px;border-radius:8px;margin:4px 6px;color:var(--text-dim);font-size:12px}
.leftnav .bank button{border:1px solid #2a455b;background:#203646;color:var(--text);border-radius:6px;padding:2px 6px;font-size:11px;cursor:pointer}
.leftnav .qn-builder{background:#162c3b;margin:8px 6px;padding:8px 10px;border:1px solid #244458;border-radius:8px}
.leftnav .qn-builder .subhdr{font-size:11px;font-weight:600;letter-spacing:.5px;color:#9fb8c9;margin-bottom:4px}
.leftnav .qn-builder .qn-list{margin:0;padding-left:18px;max-height:120px;overflow:auto;font-size:12px;color:#cddae3}
.leftnav .mini-count{background:#274b62;color:#b9d6e7;font-size:10px;padding:2px 6px;border-radius:12px;margin-left:auto}

/* Inspector */
.inspector .tabs{display:flex;border-bottom:1px solid var(--panel-border);background:rgba(255,255,255,.02)}
.inspector .tab{padding:8px 14px;cursor:pointer;font-size:13px;color:var(--text-dim);position:relative;transition:var(--transition)}
.inspector .tab:hover{color:var(--text)}
.inspector .tab.active{color:var(--text);font-weight:500}
.inspector .tab.active:after{content:"";position:absolute;left:12px;right:12px;bottom:0;height:2px;background:linear-gradient(90deg,#2563eb,#1e8a78)}
.inspector label{display:block;margin-top:12px;font-size:11px;letter-spacing:.5px;text-transform:uppercase;color:var(--text-dim)}
.inspector input,.inspector select,.inspector textarea{width:100%;padding:8px 10px;margin-top:4px;background:#162635;border:1px solid #283d50;border-radius:8px;color:var(--text);font-size:13px;transition:var(--transition);font-family:inherit}
.inspector input:focus,.inspector select:focus,.inspector textarea:focus{outline:2px solid var(--focus);outline-offset:1px}
.inspector button.btn.primary{margin-top:12px;background:linear-gradient(135deg,#2563eb,#1e8a78);border:none;color:#fff;padding:8px 14px;border-radius:8px;font-size:13px;cursor:pointer;box-shadow:0 0 0 0 var(--accent-glow);transition:var(--transition)}
.inspector button.btn.primary:hover{box-shadow:0 0 0 3px var(--accent-glow)}

/* small utilities */
.mt6{margin-top:6px}
.mt8{margin-top:8px}
.mt10{margin-top:10px}
/* canvas container */
.canvas{height:100%;width:100%;background:radial-gradient(circle at 40% 40%,#1a2b3a 0%,#0f1923 70%)}
/* node visuals */
.node-box{border:1px solid #2a455b; border-radius:10px; padding:10px 12px; min-width:140px; box-shadow:0 4px 10px -2px rgba(0,0,0,.5),0 0 0 1px rgba(255,255,255,.04);background:linear-gradient(160deg,#1b3042,#162635);position:relative;overflow:hidden}
.node-box:before{content:"";position:absolute;inset:0;background:radial-gradient(circle at 20% 15%,rgba(255,255,255,.07),transparent 60%);mix-blend-mode:overlay;pointer-events:none}
.node-box .node-title{font-weight:600;letter-spacing:.4px;color:#fff;font-size:13px}
.node-box .node-sub{font-size:11px; color:#a8c2d6; margin-top:3px}
.node-box.pill{border-radius:999px}
.node-box.is-start{background:linear-gradient(150deg,#0d4a7a,#0e2d47)}
.node-box.is-end{background:linear-gradient(150deg,#651d25,#3a0f14)}
.node-box.is-question{background:linear-gradient(150deg,#1f3345,#182633)}
.node-box.is-vt{background:linear-gradient(150deg,#1e4d39,#17362a)}
.node-box.is-pool{background:linear-gradient(150deg,#263b78,#1b2b52)}
.node-box.c-teal{box-shadow:0 0 0 1px #2a9d8f inset}
.node-box.c-blue{box-shadow:0 0 0 1px #2563eb inset}
.node-box.c-purple{box-shadow:0 0 0 1px #6d28d9 inset}
.node-box.c-orange{box-shadow:0 0 0 1px #d97706 inset}
body.epic .node-box {
  background:#28374c;
  border:1px solid #3a4d63;
  color:var(--epic-text);
  box-shadow:0 0 0 1px rgba(0,0,0,.4),0 2px 6px -2px rgba(0,0,0,.7);
}
body.epic .node-box.is-question { border-left:4px solid var(--epic-accent); }
body.epic .node-box.is-vt { border-left:4px solid var(--epic-green); }
body.epic .node-box.is-pool { border-left:4px solid var(--epic-warn); }
body.epic .node-box.is-start { border-left:4px solid #bbb; }
body.epic .node-box.is-end { border-left:4px solid var(--epic-danger); }
body.epic .react-flow__node.selected .node-box { box-shadow:0 0 0 2px var(--epic-accent),0 0 0 4px rgba(93,145,255,.3); }
body.epic .react-flow__edge-path { stroke:var(--epic-accent); stroke-width:2; }
body.epic .react-flow__edge.animated path { stroke-dasharray:5 5; }
body.epic .react-flow__background { background:radial-gradient(circle at 40% 40%, #1e2a3a, #111820 70%); }
body.epic .tabs .tab.active { background:#2d3c52; color:#fff; }
body.epic .tabs .tab { background:#233244; color:#c0cedd; }
body.epic input, body.epic select, body.epic textarea {
  background:#2a394c; border:1px solid #364b63; color:var(--epic-text);
}
body.epic input:focus, body.epic select:focus, body.epic textarea:focus{ outline:2px solid var(--epic-accent); border-color:var(--epic-accent); }
body.epic .btn.primary { background:var(--epic-accent); color:#fff; box-shadow:0 0 0 1px var(--epic-accent-glow),0 4px 16px -4px var(--epic-accent-glow); }
body.epic .btn.primary:hover { filter:brightness(1.1); }

/* Focus & interactions */
:focus-visible{outline:2px solid var(--focus);outline-offset:2px;border-radius:4px}
.button,button{transition:var(--transition)}

/* Utility */
.text-dim{color:var(--text-dim)}
.row { display:flex; gap:.5rem; align-items:center; }
.row.align-end { align-items:flex-end; }

/* flow-tools component */
.flow-tools{position:absolute;top:16px;left:16px;z-index:40;display:flex;flex-direction:column;background:rgba(20,32,44,.85);-webkit-backdrop-filter:blur(14px) saturate(160%);backdrop-filter:blur(14px) saturate(160%);border:1px solid #284055;border-radius:14px;padding:8px;gap:6px;min-width:58px;transition:240ms cubic-bezier(.4,.2,.2,1);box-shadow:0 4px 16px -4px rgba(0,0,0,.55),0 0 0 1px rgba(255,255,255,.05)}
.flow-tools.closed{height:42px;overflow:hidden;padding:4px 6px;min-width:42px}
.flow-tools .toggle{align-self:flex-end;background:#203444;border:1px solid #335368;border-radius:10px;padding:4px 8px;color:#d2e2ef;font-size:13px;cursor:pointer}
.flow-tools .tool-groups{display:flex;flex-direction:column;gap:10px}
.flow-tools .grp{display:flex;flex-wrap:wrap;gap:6px;align-items:center}
.flow-tools .grp .hdr{width:100%;font-size:10px;letter-spacing:.7px;text-transform:uppercase;color:#7fa2be;font-weight:600;margin-bottom:2px}
.flow-tools button{background:#1f3242;color:#d6e6f3;border:1px solid #335368;border-radius:8px;padding:4px 8px;font-size:12px;cursor:pointer;transition:var(--transition)}
.flow-tools button:hover{background:#274457;border-color:#417596}
.flow-tools .menu-wrapper{position:relative}
.flow-tools .menu{position:absolute;top:110%;left:0;background:#1b2d3b;border:1px solid #335368;padding:4px 0;min-width:140px;border-radius:10px;box-shadow:0 8px 28px -8px rgba(0,0,0,.6)}
.flow-tools .menu-item{padding:6px 10px;font-size:12px;color:#b7c9d6;cursor:pointer}
.flow-tools .menu-item:hover{background:#254055;color:#fff}
.flow-tools .menu .empty{padding:6px 10px;font-size:11px;color:#6c8192}
body.epic .flow-tools{background:#253246;border-color:#314255}
body.epic .flow-tools button{background:#2a3d52;border-color:#3d5468;color:#d0dbe6}
body.epic .flow-tools button:hover{background:#324a63}
.snap-indicator{position:absolute;bottom:8px;left:12px;font-size:11px;opacity:.7;background:rgba(0,0,0,.35);padding:4px 8px;border-radius:8px;color:#d0dee8;pointer-events:none}
.guide-vert, .guide-horz{position:absolute;pointer-events:none;background:rgba(93,145,255,.55);z-index:50}
.guide-vert{top:0;bottom:0;width:2px}
.guide-horz{left:0;right:0;height:2px}
.guide-vert[data-pos]{--x:attr(data-pos number); transform:translateX(var(--x));}
.guide-horz[data-pos]{--y:attr(data-pos number); transform:translateY(var(--y));}
/* attr() for transforms not widely supported; consider JS style injection for cross-browser support */

/* New styles */
.context-header{padding:4px 16px;font-size:11px;background:#1e2b38;color:#9fb3c4;letter-spacing:.5px;border-bottom:1px solid #243544}
.rightbar-content h4{margin:0 0 8px;font-size:12px;letter-spacing:.6px;text-transform:uppercase;color:#8ea7b9}
.footer-status{display:flex;gap:20px;align-items:center;justify-content:flex-end;padding:6px 14px;font-size:11px;background:#1b2732;color:#9db1c2;border-top:1px solid #2a3a49}
.footer-status .hint{margin-left:auto;color:#5b8dd9}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:100}
.modal{background:#243241;border:1px solid #2f4354;border-radius:12px;padding:20px;min-width:320px;box-shadow:0 8px 34px -8px rgba(0,0,0,.6)}
.modal h3{margin-top:0;font-size:16px;color:#d5e5ef}
.modal ul{padding-left:18px;font-size:13px;line-height:1.4}
.modal button{margin-top:12px;background:#2f4354;border:1px solid #3d5568;color:#d5e5ef;padding:6px 12px;border-radius:8px;cursor:pointer}
.modal button:hover{background:#385368}
/* Button variants */
.btn{font-size:12px;line-height:1.1;border-radius:8px;padding:6px 12px;border:1px solid #34536a;background:#233646;color:#d3e1ec;cursor:pointer;transition:var(--transition)}
.btn:hover{background:#2d4a5e}
.btn.primary{background:linear-gradient(135deg,#5b8dd9,#4373bd);border:none;color:#fff}
.btn.primary:hover{filter:brightness(1.07)}
.btn.outline{background:transparent;border:1px solid #4d6d88;color:#aac1d1}
.btn.outline:hover{background:#274458}
.btn.ghost{background:transparent;border:1px solid transparent;color:#aac1d1}
.btn.ghost:hover{background:#203444;border-color:#2d4a5e}
/* Scrollbar refinement */
::-webkit-scrollbar{width:10px}
::-webkit-scrollbar-thumb{background:#2f4455;border-radius:16px;border:2px solid #18242f}
::-webkit-scrollbar-thumb:hover{background:#3d5b72}
/* Guide positioning fallback: JS can set inline transform if attr() unsupported */
.guide-vert{pointer-events:none}
.guide-horz{pointer-events:none}
/* Density tweaks */
.leftnav .item{padding:5px 8px}
.node-box{padding:8px 10px}
.context-menu{position:absolute;z-index:60;background:#243241;border:1px solid #2e4456;border-radius:10px;padding:8px 10px;min-width:140px;box-shadow:0 12px 32px -8px rgba(0,0,0,.55);}
.context-menu .ctx-group{font-size:12px;color:#c7d6e1;display:flex;align-items:center;gap:8px}
.context-menu[data-x][data-y]{left:0;top:0;transform:translate(var(--cmx,0), var(--cmy,0));}
.impact-highlight { outline: 2px solid var(--accent, #4dabf7) !important; box-shadow: 0 0 0 4px rgba(77,171,247,0.25); }
.edge-actions{position:absolute;left:0;top:0;transform:translate(var(--ex, -50%), var(--ey, -50%));display:flex;gap:4px;opacity:0;transition:var(--transition)}
.edge-actions[data-x][data-y]{--ex:calc(attr(data-x number)*1px);--ey:calc(attr(data-y number)*1px)}
.edge-actions .edge-btn{background:#203444;border:1px solid #335368;color:#c5d6e2;font-size:11px;padding:2px 6px;border-radius:6px;cursor:pointer}
.edge-actions .edge-btn:hover{background:#2d4a62}
.react-flow__edge:hover + .react-flow__edge-label .edge-actions, .react-flow__edge-label:hover .edge-actions{opacity:1}
.context-menu .ctx-group{display:flex;flex-direction:column;gap:4px}
.context-menu button{background:#203646;border:1px solid #2d4a5e;color:#d0dde7;border-radius:6px;padding:4px 8px;font-size:12px;cursor:pointer;text-align:left;transition:var(--transition)}
.title.collapsible{display:flex;align-items:center;gap:6px;cursor:pointer;-webkit-user-select:none;user-select:none}
.title.collapsible .chevron{font-size:12px;display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;border-radius:4px;background:#1d3140;color:#7fa2be}
.title.collapsible .chevron:hover{background:#254457;color:#cfe2ef}
.title.collapsible .label{flex:1}
.title.collapsible .add-btn{margin-left:auto}
.qn-list{list-style:none;padding-left:0;margin:4px 0 0 0}
.qn-list .qn-row{display:flex;align-items:center;gap:6px;padding:4px 6px;border:1px solid #244458;border-radius:6px;margin:3px 4px;background:#1a2c3a;font-size:12px;transition:var(--transition)}
.qn-list .qn-row.over{outline:2px dashed #4d7bb5}
.qn-list .qn-row.dragging{opacity:.45}
.qn-row .handle{cursor:grab;color:#6c8294;font-size:12px}
.qn-row .handle:active{cursor:grabbing}
.qn-row .idx{width:20px;text-align:right;font-variant-numeric:tabular-nums;color:#8099a9}
.qn-row .row-actions{margin-left:auto;display:flex;gap:2px}
.qn-row .row-actions button{background:#203646;border:1px solid #2d4a5e;color:#87a7ba;border-radius:4px;padding:2px 6px;font-size:11px;cursor:pointer}
.qn-row .row-actions button:hover{background:#2b4b60;color:#d1e3ef}